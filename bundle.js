!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t="function"==typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},a=function(e,n){return Array.prototype.slice.call(e,n)},i=function(e,n,a){e&&t((function(){e.apply(a||null,n||[])}))},r=e.CustomEvent;var o=function(){try{var e=new r("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?r:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,n){var t=document.createEvent("CustomEvent");return n?t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):t.initCustomEvent(e,!1,!1,void 0),t}:function(e,n){var t=document.createEventObject();return t.type=e,n?(t.bubbles=Boolean(n.bubbles),t.cancelable=Boolean(n.cancelable),t.detail=n.detail):(t.bubbles=!1,t.cancelable=!1,t.detail=void 0),t},u=[],c="",s=/^on/;for(c in e)s.test(c)&&u.push(c.slice(2));var l=o,d=u,m=e.document,f=function(e,n,t,a){return e.addEventListener(n,t,a)},v=function(e,n,t,a){return e.removeEventListener(n,t,a)},p=[];e.addEventListener||(f=function(n,t,a){return n.attachEvent("on"+t,function(n,t,a){var i=b(n,t,a)||function(n,t,a){return function(t){var i=t||e.event;i.target=i.target||i.srcElement,i.preventDefault=i.preventDefault||function(){i.returnValue=!1},i.stopPropagation=i.stopPropagation||function(){i.cancelBubble=!0},i.which=i.which||i.keyCode,a.call(n,i)}}(n,0,a);return p.push({wrapper:i,element:n,type:t,fn:a}),i}(n,t,a))},v=function(e,n,t){var a=b(e,n,t);if(a)return e.detachEvent("on"+n,a)});var h={add:f,remove:v,fabricate:function(e,n,t){var a=-1===d.indexOf(n)?new l(n,{detail:t}):function(){var e;m.createEvent?(e=m.createEvent("Event")).initEvent(n,!0,!0):m.createEventObject&&(e=m.createEventObject());return e}();e.dispatchEvent?e.dispatchEvent(a):e.fireEvent("on"+n,a)}};function b(e,n,t){var a=function(e,n,t){var a,i;for(a=0;a<p.length;a++)if((i=p[a]).element===e&&i.type===n&&i.fn===t)return a}(e,n,t);if(a){var i=p[a].wrapper;return p.splice(a,1),i}}var g={};function k(e){var n=g[e];return n?n.lastIndex=0:g[e]=n=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)","g"),n}var R=function(e,n){var t=n||{},r={};return void 0===e&&(e={}),e.on=function(n,t){return r[n]?r[n].push(t):r[n]=[t],e},e.once=function(n,t){return t._once=!0,e.on(n,t),e},e.off=function(n,t){var a=arguments.length;if(1===a)delete r[n];else if(0===a)r={};else{var i=r[n];if(!i)return e;i.splice(i.indexOf(t),1)}return e},e.emit=function(){var n=a(arguments);return e.emitterSnapshot(n.shift()).apply(this,n)},e.emitterSnapshot=function(n){var o=(r[n]||[]).slice(0);return function(){var r=a(arguments),u=this||e;if("error"===n&&!1!==t.throws&&!o.length)throw 1===r.length?r[0]:r;return o.forEach((function(a){t.async?i(a,r,u):a.apply(u,r),a._once&&e.off(n,a)})),e}},e},y=h,T={add:function(e,n){var t=e.className;t.length?k(n).test(t)||(e.className+=" "+n):e.className=n},rm:function(e,n){e.className=e.className.replace(k(n)," ").trim()}},S=document,w=S.documentElement;function C(n,t,a,i){e.navigator.pointerEnabled?y[t](n,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[a],i):e.navigator.msPointerEnabled?y[t](n,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[a],i):(y[t](n,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[a],i),y[t](n,a,i))}function D(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function E(n,t){return void 0!==e[t]?e[t]:w.clientHeight?w[n]:S.body[n]}function P(e,n,t){var a,i=(e=e||{}).className||"";return e.className+=" gu-hide",a=S.elementFromPoint(n,t),e.className=i,a}function O(){return!1}function x(){return!0}function N(e){return e.width||e.right-e.left}function H(e){return e.height||e.bottom-e.top}function B(e){return e.parentNode===S?null:e.parentNode}function J(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||A(e)}function A(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||A(B(e))))}function F(e){return e.nextElementSibling||function(){var n=e;do{n=n.nextSibling}while(n&&1!==n.nodeType);return n}()}function I(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),a={pageX:"clientX",pageY:"clientY"};return e in a&&!(e in t)&&a[e]in t&&(e=a[e]),t[e]}var L=function(e,n){var t,a,i,r,o,u,c,s,l,d,m;1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var f,v=null,p=n||{};void 0===p.moves&&(p.moves=x),void 0===p.accepts&&(p.accepts=x),void 0===p.invalid&&(p.invalid=function(){return!1}),void 0===p.containers&&(p.containers=e||[]),void 0===p.isContainer&&(p.isContainer=O),void 0===p.copy&&(p.copy=!1),void 0===p.copySortSource&&(p.copySortSource=!1),void 0===p.revertOnSpill&&(p.revertOnSpill=!1),void 0===p.removeOnSpill&&(p.removeOnSpill=!1),void 0===p.direction&&(p.direction="vertical"),void 0===p.ignoreInputTextSelection&&(p.ignoreInputTextSelection=!0),void 0===p.mirrorContainer&&(p.mirrorContainer=S.body);var h=R({containers:p.containers,start:function(e){var n=_(e);n&&Q(n)},end:X,cancel:$,remove:j,destroy:function(){g(!0),q({})},canMove:function(e){return!!_(e)},dragging:!1});return!0===p.removeOnSpill&&h.on("over",(function(e){T.rm(e,"gu-hide")})).on("out",(function(e){h.dragging&&T.add(e,"gu-hide")})),g(),h;function b(e){return-1!==h.containers.indexOf(e)||p.isContainer(e)}function g(e){var n=e?"remove":"add";C(w,n,"mousedown",K),C(w,n,"mouseup",q)}function k(e){C(w,e?"remove":"add","mousemove",M)}function A(e){var n=e?"remove":"add";y[n](w,"selectstart",L),y[n](w,"click",L)}function L(e){f&&e.preventDefault()}function K(e){if(u=e.clientX,c=e.clientY,!(1!==D(e)||e.metaKey||e.ctrlKey)){var n=e.target,t=_(n);t&&(f=t,k(),"mousedown"===e.type&&(J(n)?n.focus():e.preventDefault()))}}function M(e){if(f)if(0!==D(e)){if(!(void 0!==e.clientX&&Math.abs(e.clientX-u)<=(p.slideFactorX||0)&&void 0!==e.clientY&&Math.abs(e.clientY-c)<=(p.slideFactorY||0))){if(p.ignoreInputTextSelection){var n=I("clientX",e)||0,a=I("clientY",e)||0;if(J(S.elementFromPoint(n,a)))return}var s=f;k(!0),A(),X(),Q(s);var l,m={left:(l=i.getBoundingClientRect()).left+E("scrollLeft","pageXOffset"),top:l.top+E("scrollTop","pageYOffset")};r=I("pageX",e)-m.left,o=I("pageY",e)-m.top,T.add(d||i,"gu-transit"),function(){if(t)return;var e=i.getBoundingClientRect();(t=i.cloneNode(!0)).style.width=N(e)+"px",t.style.height=H(e)+"px",T.rm(t,"gu-transit"),T.add(t,"gu-mirror"),p.mirrorContainer.appendChild(t),C(w,"add","mousemove",G),T.add(p.mirrorContainer,"gu-unselectable"),h.emit("cloned",t,i,"mirror")}(),G(e)}}else q({})}function _(e){if(!(h.dragging&&t||b(e))){for(var n=e;B(e)&&!1===b(B(e));){if(p.invalid(e,n))return;if(!(e=B(e)))return}var a=B(e);if(a)if(!p.invalid(e,n))if(p.moves(e,a,n,F(e)))return{item:e,source:a}}}function Q(e){var n,t;n=e.item,t=e.source,("boolean"==typeof p.copy?p.copy:p.copy(n,t))&&(d=e.item.cloneNode(!0),h.emit("cloned",d,e.item,"copy")),a=e.source,i=e.item,s=l=F(e.item),h.dragging=!0,h.emit("drag",i,a)}function X(){if(h.dragging){var e=d||i;V(e,B(e))}}function Y(){f=!1,k(!0),A(!0)}function q(e){if(Y(),h.dragging){var n=d||i,r=I("clientX",e)||0,o=I("clientY",e)||0,u=z(P(t,r,o),r,o);u&&(d&&p.copySortSource||!d||u!==a)?V(n,u):p.removeOnSpill?j():$()}}function V(e,n){var t=B(e);d&&p.copySortSource&&n===a&&t.removeChild(i),W(n)?h.emit("cancel",e,a,a):h.emit("drop",e,n,a,l),U()}function j(){if(h.dragging){var e=d||i,n=B(e);n&&n.removeChild(e),h.emit(d?"cancel":"remove",e,n,a),U()}}function $(e){if(h.dragging){var n=arguments.length>0?e:p.revertOnSpill,t=d||i,r=B(t),o=W(r);!1===o&&n&&(d?r&&r.removeChild(d):a.insertBefore(t,s)),o||n?h.emit("cancel",t,a,a):h.emit("drop",t,r,a,l),U()}}function U(){var e=d||i;Y(),t&&(T.rm(p.mirrorContainer,"gu-unselectable"),C(w,"remove","mousemove",G),B(t).removeChild(t),t=null),e&&T.rm(e,"gu-transit"),m&&clearTimeout(m),h.dragging=!1,v&&h.emit("out",e,v,a),h.emit("dragend",e),a=i=d=s=l=m=v=null}function W(e,n){var r;return r=void 0!==n?n:t?l:F(d||i),e===a&&r===s}function z(e,n,t){for(var r=e;r&&!o();)r=B(r);return r;function o(){if(!1===b(r))return!1;var o=Z(r,e),u=ee(r,o,n,t);return!!W(r,u)||p.accepts(i,r,a,u)}}function G(e){if(t){e.preventDefault();var n=I("clientX",e)||0,u=I("clientY",e)||0,c=n-r,m=u-o;t.style.left=c+"px",t.style.top=m+"px";var f=d||i,b=P(t,n,u),g=z(b,n,u),k=null!==g&&g!==v;(k||null===g)&&(v&&S("out"),v=g,k&&S("over"));var R=B(f);if(g!==a||!d||p.copySortSource){var y,T=Z(g,b);if(null!==T)y=ee(g,T,n,u);else{if(!0!==p.revertOnSpill||d)return void(d&&R&&R.removeChild(f));y=s,g=a}(null===y&&k||y!==f&&y!==F(f))&&(l=y,g.insertBefore(f,y),h.emit("shadow",f,g,a))}else R&&R.removeChild(f)}function S(e){h.emit(e,f,v,a)}}function Z(e,n){for(var t=n;t!==e&&B(t)!==e;)t=B(t);return t===w?null:t}function ee(e,n,t,a){var i="horizontal"===p.direction,r=n!==e?function(){var e=n.getBoundingClientRect();if(i)return o(t>e.left+N(e)/2);return o(a>e.top+H(e)/2)}():function(){var n,r,o,u=e.children.length;for(n=0;n<u;n++){if(o=(r=e.children[n]).getBoundingClientRect(),i&&o.left+o.width/2>t)return r;if(!i&&o.top+o.height/2>a)return r}return null}();return r;function o(e){return e?F(n):n}}},K=n(L),M=[{numberRank:0,nameRank:"Two",initial:"2",suit:"Clubs",name:"Two of Clubs"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Clubs",name:"Three of Clubs"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Clubs",name:"Four of Clubs"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Clubs",name:"Five of Clubs"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Clubs",name:"Six of Clubs"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Clubs",name:"Seven of Clubs"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Clubs",name:"Eight of Clubs"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Clubs",name:"Nine of Clubs"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Clubs",name:"Ten of Clubs"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Clubs",name:"Jack of Clubs"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Clubs",name:"Queen of Clubs"},{numberRank:11,nameRank:"King",initial:"K",suit:"Clubs",name:"King of Clubs"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Clubs",name:"Ace of Clubs"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Hearts",name:"Two of Hearts"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Hearts",name:"Three of Hearts"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Hearts",name:"Four of Hearts"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Hearts",name:"Five of Hearts"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Hearts",name:"Six of Hearts"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Hearts",name:"Seven of Hearts"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Hearts",name:"Eight of Hearts"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Hearts",name:"Nine of Hearts"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Hearts",name:"Ten of Hearts"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Hearts",name:"Jack of Hearts"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Hearts",name:"Queen of Hearts"},{numberRank:11,nameRank:"King",initial:"K",suit:"Hearts",name:"King of Hearts"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Hearts",name:"Ace of Hearts"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Spades",name:"Two of Spades"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Spades",name:"Three of Spades"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Spades",name:"Four of Spades"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Spades",name:"Five of Spades"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Spades",name:"Six of Spades"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Spades",name:"Seven of Spades"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Spades",name:"Eight of Spades"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Spades",name:"Nine of Spades"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Spades",name:"Ten of Spades"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Spades",name:"Jack of Spades"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Spades",name:"Queen of Spades"},{numberRank:11,nameRank:"King",initial:"K",suit:"Spades",name:"King of Spades"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Spades",name:"Ace of Spades"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Diamonds",name:"Two of Diamonds"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Diamonds",name:"Three of Diamonds"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Diamonds",name:"Four of Diamonds"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Diamonds",name:"Five of Diamonds"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Diamonds",name:"Six of Diamonds"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Diamonds",name:"Seven of Diamonds"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Diamonds",name:"Eight of Diamonds"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Diamonds",name:"Nine of Diamonds"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Diamonds",name:"Ten of Diamonds"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Diamonds",name:"Jack of Diamonds"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Diamonds",name:"Queen of Diamonds"},{numberRank:11,nameRank:"King",initial:"K",suit:"Diamonds",name:"King of Diamonds"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Diamonds",name:"Ace of Diamonds"}],_={numberRank:99,nameRank:"Joker",initial:"JO",suit:"Joker",name:"Joker (Plain)"},Q={numberRank:99,nameRank:"Joker",initial:"JO",suit:"Joker",name:"Joker (Fancy)"},X={FancyJoker:Q,PlainJoker:_,standard52DeckOfCards:M,standard52DeckOfCardsWithJokers:[...M,_,Q]},Y=class{drawPile;discardPile;constructor(e){this.drawPile=e,this.discardPile=[],this.shuffle(7)}shuffle(e){for(var n=this.drawPile.length,t=0;t<e;t++)for(let e of this.drawPile){let t=this.drawPile.indexOf(e),a=Math.floor(Math.random()*n);this.drawPile[t]=this.drawPile[a],this.drawPile[a]=e}}addToBottomOfDiscardPile(e){this.discardPile.push(...e)}addToDiscardPile(e){this.addToTopOfDiscardPile(e)}addToTopOfDiscardPile(e){this.discardPile.unshift(...e)}drawFromDiscardPile(e){return this.discardPile.splice(0,e)}addToBottomOfDrawPile(e){this.drawPile.push(...e)}addToDrawPile(e){this.addToBottomOfDrawPile(e)}addToTopOfDrawPile(e){this.drawPile.unshift(...e)}drawFromDrawPile(e){return this.drawPile.splice(0,e)}};new Y(M);const q={C:"♣️",H:"❤️",S:"♠️",D:"♦️",J:"🤪"},V={[q.C]:"Black",[q.H]:"Red",[q.S]:"Black",[q.D]:"Red"},j=X.standard52DeckOfCards.map((e=>("Ace"!==e.nameRank&&(e.value=e.numberRank+2),"Ace"===e.nameRank&&(e.value=1),e.suit=q[e.suit[0]],e.facingDown=!0,e)));j.push({...X.FancyJoker,initial:"0",value:0,facingDown:!0,suit:q.J});const $=new Y(j),U=["b2","c2","d2","b3","c3","d3","b4","c4","d4"],W=["b1","c1","d1","a2","e2","a3","e3","a4","e4","b5","c5","d5"],z={b1:"b2",c1:"c2",d1:"d2",a2:"b2",e2:"d2",a3:"b3",e3:"d3",a4:"b4",e4:"d4",b5:"b4",c5:"c4",d5:"d4"},G={b2:[{cardsToCheck:["c2","d2"],royalPile:"e2"},{cardsToCheck:["b3","b4"],royalPile:"b5"}],c2:[{cardsToCheck:["c3","c4"],royalPile:"c5"}],d2:[{cardsToCheck:["c2","b2"],royalPile:"a2"},{cardsToCheck:["d3","d4"],royalPile:"d5"}],b3:[{cardsToCheck:["c3","d3"],royalPile:"e3"}],c3:[],d3:[{cardsToCheck:["c3","b3"],royalPile:"a3"}],b4:[{cardsToCheck:["c4","d4"],royalPile:"e4"},{cardsToCheck:["b3","b2"],royalPile:"b1"}],c4:[{cardsToCheck:["c3","c2"],royalPile:"c1"}],d4:[{cardsToCheck:["c4","b4"],royalPile:"a4"},{cardsToCheck:["d3","d2"],royalPile:"d1"}]};let Z={a2:{cards:[]},a3:{cards:[]},a4:{cards:[]},b1:{cards:[]},b2:{cards:[]},b3:{cards:[]},b4:{cards:[]},b5:{cards:[]},c1:{cards:[]},c2:{cards:[]},c3:{cards:[]},c4:{cards:[]},c5:{cards:[]},d1:{cards:[]},d2:{cards:[]},d3:{cards:[]},d4:{cards:[]},d5:{cards:[]},e2:{cards:[]},e3:{cards:[]},e4:{cards:[]},e5:{cards:$.drawPile}};function ee(e){Z=e}function ne(e){return e.value>10}function te(e){return Z[e].cards}function ae(e){return Z[e].cards.slice(0,1)[0]}function ie(e){return e.find((e=>ne(e)))}const re=document.getElementById("faceUpCardTemplate"),oe=document.getElementById("faceDownCardTemplate"),ue=document.getElementById("emptyCardTemplate");function ce(){Object.entries(Z).forEach((([e,{cards:n}])=>{const t=Array.from(n);U.includes(e)&&t.reverse();const a=t.map(((n,t)=>{if(n.facingDown){return function(e,n){const t=oe?.content.cloneNode(!0),a=t.querySelector(".mo-card");if(a&&a.setAttribute("style",`--index: ${e}`),a&&n){const e=a.querySelector(".mo-card__back");e&&(e.textContent="Dead")}return t}(t,"e5"!==e)}return"e5"===e&&(t=99),function(e,n){const t=re?.content.cloneNode(!0),a=t.querySelector(".mo-card");function i(e,n,t){const a=e.querySelector(n);a&&(a.innerHTML=t)}return a&&a.setAttribute("style",`--index: ${n}`),i(t,".mo-card__rank",e.initial),i(t,".mo-card__suit",e.suit),i(t,".mo-card__name",e.name),"Red"===V[e.suit]&&t.querySelector(".mo-card__suit")?.classList.add("red"),t}(n,t)})),i=function(e){const n=ue?.content.cloneNode(!0),t=n.querySelector(".mo-card");return t&&t.setAttribute("style",`--index: ${e}`),n}(a.length);a.push(i);const r=document.querySelector(`#${e}.pile`);r?.replaceChildren(...a)}))}const se=()=>{let e=[null],n=0;return{doShift(t,a){n<e.length-1&&(e=e.slice(0,n+1));const i=structuredClone(Z);!function(e,n){const t=Z[e].cards.shift();if(t){if("Ace"===t.nameRank||"Joker"===t.nameRank){const e=Z[n].cards.splice(0);e.forEach((e=>e.facingDown=!0)),Z.e5.cards.push(...e)}Z[e].cards.length&&(Z[e].cards[0].facingDown=!1),Z[n].cards.unshift(t)}}(t,a);const r=structuredClone(Z);e.push({prevPile:i,nextPile:r}),n+=1},undo(){if(n>0){const{prevPile:t}=e[n];n-=1,ee(t)}ce()},redo(){if(n<e.length-1){n+=1;const{nextPile:t}=e[n];ee(t)}ce()}}};function le(e){let n;return ne(e)?function(e){let n=function(e){let n=[];return n=W.reduce(((n,t)=>{if(0!==Z[t].cards.length)return n;const a=ae(z[t]),i=function(e,n,t){const a=n.suit,i=n.value;return a===t.suit?{pileID:e,neighborValue:i,matchType:"suit"}:null}(t,a,e);if(i&&n.push(i),!i){const i=function(e,n,t){const a=n.suit,i=V[a],r=n.value;return i===V[t.suit]?{pileID:e,neighborValue:r,matchType:"color"}:null}(t,a,e);i&&n.push(i),i||n.push({pileID:t,neighborValue:a.value,matchType:"extra"})}return n}),[]),n}(e);const t={suit:0,color:1,extra:2};return n=n.sort(((e,n)=>t[e.matchType]-t[n.matchType])).reduce(((e,n)=>e[0]?(e[0].matchType===n.matchType&&e[0].neighborValue===n.neighborValue&&e.push(n),e[0].matchType===n.matchType&&e[0].neighborValue<n.neighborValue&&(e=[n]),e):(e.push(n),e)),[]),n.map((e=>e.pileID))}(e):(n=function(e){return 0===e.value?function(){return U.map((e=>{const n=ae(e);return{value:n?.value||99,pileID:e}})).sort(((e,n)=>e.value-n.value)).reduce(((e,n)=>(0===e.length&&n.value<99||e[0].value===n.value?e.push(n):e[0].value>n.value&&(e=[n]),e)),[]).map((e=>e.pileID))}():U.reduce(((n,t)=>{if(1===e.value)n.push(t);else{const a=ae(t);(a&&a.value<=e.value||!a)&&n.push(t)}return n}),[])}(e),n.length?n:function(e){return W.reduce(((n,t)=>{const a=te(t);if(0===a.length)return n;if(function(e){return e.some((e=>ne(e)&&e.facingDown))}(a))return n;const i=function(e){return e.reduce(((e,n)=>e+n.value),0)}(a);return i+e.value<21&&n.push(t),n}),[])}(e))}const de={J:function(e,n){return e.map((e=>ae(e))).reduce(((e,n)=>e+=n?.value||0),0)>=n.reduce(((e,n)=>e+=n.value),0)},Q:function(e,n){const t=ie(n);if(!t)return!1;const a=V[t.suit],i=n.reduce(((e,n)=>e+=n.value),0);return e.map((e=>ae(e))).filter((e=>e&&V[e.suit]===a)).reduce(((e,n)=>e+=n?.value||0),0)>=i},K:function(e,n){const t=ie(n);if(!t)return!1;const a=t.suit,i=n.reduce(((e,n)=>e+=n.value),0);return e.map((e=>ae(e))).filter((e=>e&&e.suit===a)).reduce(((e,n)=>e+=n?.value||0),0)>=i}},me=()=>{let e="";let n=!1,t=!1;return{tick:a=>{const i=te("e5");if(!W.includes(a)||!i.length){if(function(e){G[e].forEach((e=>{const n=te(e.royalPile),t=ie(n);t&&de[t.initial](e.cardsToCheck,n)&&n.forEach((e=>e.facingDown=!0))}))}(a),n=W.every((e=>{const n=te(e);return n.length>0&&n.every((e=>e.facingDown))})),n){console.log("YOU WIN!");const e=document.getElementById("gameWonDialog");return e.showModal(),void e.querySelector("#gameWonCloseButton")?.addEventListener("click",(()=>{e.close()}))}if(t=function(){const n=ae("e5");return n?0===le(n).length?(e="No valid place to play card.",!0):void 0:(e="No more cards in draw pile.",!0)}(),t){const n=document.getElementById("gameLostDialog"),t=n.querySelector("#gameLostReason");t&&(t.innerHTML=e),n.showModal(),n.querySelector("#gameLostCloseButton")?.addEventListener("click",(()=>{n.close()}))}}}}};let fe,ve;function pe(){fe=se(),ve=me(),Object.entries(Z).forEach((([e,{cards:n}])=>{if("e5"!==e){const e=n.splice(0);e.forEach((e=>e.facingDown=!0)),$.addToDrawPile(e)}})),$.shuffle(3),function(){let e=!1,n=[];const t=Array.from(U);for(;!e;){const a=$.drawFromDrawPile(1)[0];if(a.facingDown=!1,ne(a))a.facingDown=!0,n.push(a);else{const e=t.shift();e&&"c3"!==e&&Z[e].cards.push(a)}0===t.length&&(e=!0)}$.addToTopOfDrawPile(n),$.drawPile[0].facingDown=!1}(),ce()}document.addEventListener("DOMContentLoaded",(function(){pe()})),document.getElementById("newGameButton")?.addEventListener("click",(()=>pe())),document.getElementById("undoButton")?.addEventListener("click",(()=>fe.undo())),document.getElementById("redoButton")?.addEventListener("click",(()=>fe.redo()));const he=K(Array.from(document.getElementsByClassName("pile")),{moves:function(e,n){return!!n&&n.classList.contains("pile--drawpile")},accepts:function(e,n,t){const a=t?.id,i=n?.id;return!(!a||!i)&&function(e,n){return le(ae(e)).includes(n)}(a,i)}});he.on("drag",(function(e,n){const t=ae(n.id),a=t?le(t):[];a.length&&function(e){e.forEach((e=>{const n=document.getElementById(e);n?.classList.add("pile--valid")}))}(a)})),he.on("drop",(function(e,n,t){Array.from(document.getElementsByClassName("pile--valid")).forEach((e=>e.classList.remove("pile--valid")));const a=t.id,i=n.id;fe.doShift(a,i),ve.tick(i),ce()}))}();

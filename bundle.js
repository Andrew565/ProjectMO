!function(){"use strict";var e=[{numberRank:0,nameRank:"Two",initial:"2",suit:"Clubs",name:"Two of Clubs"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Clubs",name:"Three of Clubs"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Clubs",name:"Four of Clubs"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Clubs",name:"Five of Clubs"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Clubs",name:"Six of Clubs"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Clubs",name:"Seven of Clubs"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Clubs",name:"Eight of Clubs"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Clubs",name:"Nine of Clubs"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Clubs",name:"Ten of Clubs"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Clubs",name:"Jack of Clubs"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Clubs",name:"Queen of Clubs"},{numberRank:11,nameRank:"King",initial:"K",suit:"Clubs",name:"King of Clubs"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Clubs",name:"Ace of Clubs"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Hearts",name:"Two of Hearts"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Hearts",name:"Three of Hearts"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Hearts",name:"Four of Hearts"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Hearts",name:"Five of Hearts"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Hearts",name:"Six of Hearts"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Hearts",name:"Seven of Hearts"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Hearts",name:"Eight of Hearts"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Hearts",name:"Nine of Hearts"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Hearts",name:"Ten of Hearts"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Hearts",name:"Jack of Hearts"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Hearts",name:"Queen of Hearts"},{numberRank:11,nameRank:"King",initial:"K",suit:"Hearts",name:"King of Hearts"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Hearts",name:"Ace of Hearts"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Spades",name:"Two of Spades"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Spades",name:"Three of Spades"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Spades",name:"Four of Spades"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Spades",name:"Five of Spades"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Spades",name:"Six of Spades"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Spades",name:"Seven of Spades"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Spades",name:"Eight of Spades"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Spades",name:"Nine of Spades"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Spades",name:"Ten of Spades"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Spades",name:"Jack of Spades"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Spades",name:"Queen of Spades"},{numberRank:11,nameRank:"King",initial:"K",suit:"Spades",name:"King of Spades"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Spades",name:"Ace of Spades"},{numberRank:0,nameRank:"Two",initial:"2",suit:"Diamonds",name:"Two of Diamonds"},{numberRank:1,nameRank:"Three",initial:"3",suit:"Diamonds",name:"Three of Diamonds"},{numberRank:2,nameRank:"Four",initial:"4",suit:"Diamonds",name:"Four of Diamonds"},{numberRank:3,nameRank:"Five",initial:"5",suit:"Diamonds",name:"Five of Diamonds"},{numberRank:4,nameRank:"Six",initial:"6",suit:"Diamonds",name:"Six of Diamonds"},{numberRank:5,nameRank:"Seven",initial:"7",suit:"Diamonds",name:"Seven of Diamonds"},{numberRank:6,nameRank:"Eight",initial:"8",suit:"Diamonds",name:"Eight of Diamonds"},{numberRank:7,nameRank:"Nine",initial:"9",suit:"Diamonds",name:"Nine of Diamonds"},{numberRank:8,nameRank:"Ten",initial:"10",suit:"Diamonds",name:"Ten of Diamonds"},{numberRank:9,nameRank:"Jack",initial:"J",suit:"Diamonds",name:"Jack of Diamonds"},{numberRank:10,nameRank:"Queen",initial:"Q",suit:"Diamonds",name:"Queen of Diamonds"},{numberRank:11,nameRank:"King",initial:"K",suit:"Diamonds",name:"King of Diamonds"},{numberRank:12,nameRank:"Ace",initial:"A",suit:"Diamonds",name:"Ace of Diamonds"}],n={numberRank:99,nameRank:"Joker",initial:"JO",suit:"Joker",name:"Joker (Fancy)"},a={FancyJoker:n,standard52DeckOfCards:e},i=class{drawPile;discardPile;constructor(e){this.drawPile=e,this.discardPile=[],this.shuffle(7)}shuffle(e){for(var n=this.drawPile.length,a=0;a<e;a++)for(let e of this.drawPile){let a=this.drawPile.indexOf(e),i=Math.floor(Math.random()*n);this.drawPile[a]=this.drawPile[i],this.drawPile[i]=e}}addToBottomOfDiscardPile(e){this.discardPile.push(...e)}addToDiscardPile(e){this.addToTopOfDiscardPile(e)}addToTopOfDiscardPile(e){this.discardPile.unshift(...e)}drawFromDiscardPile(e){return this.discardPile.splice(0,e)}addToBottomOfDrawPile(e){this.drawPile.push(...e)}addToDrawPile(e){this.addToBottomOfDrawPile(e)}addToTopOfDrawPile(e){this.drawPile.unshift(...e)}drawFromDrawPile(e){return this.drawPile.splice(0,e)}};new i(e);const t={C:"♣️",H:"❤️",S:"♠️",D:"♦️",J:"🤪"},r={[t.C]:"Black",[t.H]:"Red",[t.S]:"Black",[t.D]:"Red"},s=a.standard52DeckOfCards.map((e=>("Ace"!==e.nameRank&&(e.value=e.numberRank+2),"Ace"===e.nameRank&&(e.value=1),e.suit=t[e.suit[0]],e.facingDown=!0,e)));s.push({...a.FancyJoker,initial:"0",value:0,facingDown:!0,suit:t.J});const o=new i(s),u=["b2","c2","d2","b3","c3","d3","b4","c4","d4"],c=["b1","c1","d1","a2","e2","a3","e3","a4","e4","b5","c5","d5"],l={b1:"b2",c1:"c2",d1:"d2",a2:"b2",e2:"d2",a3:"b3",e3:"d3",a4:"b4",e4:"d4",b5:"b4",c5:"c4",d5:"d4"},d={b2:[{cardsToCheck:["c2","d2"],royalPile:"e2"},{cardsToCheck:["b3","b4"],royalPile:"b5"}],c2:[{cardsToCheck:["c3","c4"],royalPile:"c5"}],d2:[{cardsToCheck:["c2","b2"],royalPile:"a2"},{cardsToCheck:["d3","d4"],royalPile:"d5"}],b3:[{cardsToCheck:["c3","d3"],royalPile:"e3"}],c3:[],d3:[{cardsToCheck:["c3","b3"],royalPile:"a3"}],b4:[{cardsToCheck:["c4","d4"],royalPile:"e4"},{cardsToCheck:["b3","b2"],royalPile:"b1"}],c4:[{cardsToCheck:["c3","c2"],royalPile:"c1"}],d4:[{cardsToCheck:["c4","b4"],royalPile:"a4"},{cardsToCheck:["d3","d2"],royalPile:"d1"}]};let m={a2:{cards:[]},a3:{cards:[]},a4:{cards:[]},b1:{cards:[]},b2:{cards:[]},b3:{cards:[]},b4:{cards:[]},b5:{cards:[]},c1:{cards:[]},c2:{cards:[]},c3:{cards:[]},c4:{cards:[]},c5:{cards:[]},d1:{cards:[]},d2:{cards:[]},d3:{cards:[]},d4:{cards:[]},d5:{cards:[]},e2:{cards:[]},e3:{cards:[]},e4:{cards:[]},e5:{cards:o.drawPile}};function f(e){m=e}function k(e){return e.value>10}function b(e){return m[e].cards}function h(e){return m[e].cards.slice(0,1)[0]}function R(e){return e.find((e=>k(e)))}const p=document.getElementById("faceUpCardTemplate"),g=document.getElementById("faceDownCardTemplate");function v(){Object.entries(m).forEach((([e,{cards:n}])=>{const a=Array.from(n);u.includes(e)&&a.reverse();const i=a.map(((n,a)=>n.facingDown?function(e){const n=g?.content.cloneNode(!0),a=n.querySelector(".mo-card");if(a){a.setAttribute("style",`--index: ${e}`);const n=a.querySelector(".mo-card__back");n&&(n.textContent="Dead")}return n}(a):("e5"===e&&(a=99),function(e,n){const a=p?.content.cloneNode(!0),i=a.querySelector(".mo-card");function t(e,n,a){const i=e.querySelector(n);i&&(i.innerHTML=a)}return i&&i.setAttribute("style",`--index: ${n}`),t(a,".mo-card__rank",e.initial),t(a,".mo-card__suit",e.suit),t(a,".mo-card__name",e.name),"Red"===r[e.suit]&&a.querySelector(".mo-card__suit")?.classList.add("red"),a}(n,a)))),t=document.querySelector(`#${e}.pile`);t?.replaceChildren(...i)}))}const D=()=>{let e=[null],n=0;return{doShift(a,i){n<e.length-1&&(e=e.slice(0,n+1));const t=structuredClone(m);!function(e,n){const a=m[e].cards.shift();if(a){if("Ace"===a.nameRank||"Joker"===a.nameRank){const e=m[n].cards.splice(0);e.forEach((e=>e.facingDown=!0)),m.e5.cards.push(...e)}m[e].cards.length&&(m[e].cards[0].facingDown=!1),m[n].cards.unshift(a)}}(a,i);const r=structuredClone(m);e.push({prevPile:t,nextPile:r}),n+=1},undo(){if(n>0){const{prevPile:a}=e[n];n-=1,f(a)}v()},redo(){if(n<e.length-1){n+=1;const{nextPile:a}=e[n];f(a)}v()}}};function T(e){let n;return k(e)?function(e){let n=function(e){let n=[];return n=c.reduce(((n,a)=>{if(0!==m[a].cards.length)return n;const i=h(l[a]),t=function(e,n,a){const i=n.suit,t=n.value;return i===a.suit?{pileID:e,neighborValue:t,matchType:"suit"}:null}(a,i,e);if(t&&n.push(t),!t){const t=function(e,n,a){const i=n.suit,t=r[i],s=n.value;return t===r[a.suit]?{pileID:e,neighborValue:s,matchType:"color"}:null}(a,i,e);t&&n.push(t),t||n.push({pileID:a,neighborValue:i.value,matchType:"extra"})}return n}),[]),n}(e);const a={suit:0,color:1,extra:2};return n=n.sort(((e,n)=>a[e.matchType]-a[n.matchType])).reduce(((e,n)=>e[0]?(e[0].matchType===n.matchType&&e[0].neighborValue===n.neighborValue&&e.push(n),e[0].matchType===n.matchType&&e[0].neighborValue<n.neighborValue&&(e=[n]),e):(e.push(n),e)),[]),n.map((e=>e.pileID))}(e):(n=function(e){return 0===e.value?function(){return u.map((e=>{const n=h(e);return{value:n?.value||99,pileID:e}})).sort(((e,n)=>e.value-n.value)).reduce(((e,n)=>(0===e.length&&n.value<99||e[0].value===n.value?e.push(n):e[0].value>n.value&&(e=[n]),e)),[]).map((e=>e.pileID))}():u.reduce(((n,a)=>{if(1===e.value)n.push(a);else{const i=h(a);(i&&i.value<=e.value||!i)&&n.push(a)}return n}),[])}(e),n.length?n:function(e){return c.reduce(((n,a)=>{const i=b(a);if(0===i.length)return n;if(function(e){return e.some((e=>k(e)&&e.facingDown))}(i))return n;const t=function(e){return e.reduce(((e,n)=>e+n.value),0)}(i);return t+e.value<21&&n.push(a),n}),[])}(e))}const S={J:function(e,n){return e.map((e=>h(e))).reduce(((e,n)=>e+=n?.value||0),0)>=n.reduce(((e,n)=>e+=n.value),0)},Q:function(e,n){const a=R(n);if(!a)return!1;const i=r[a.suit],t=n.reduce(((e,n)=>e+=n.value),0);return e.map((e=>h(e))).filter((e=>e&&r[e.suit]===i)).reduce(((e,n)=>e+=n?.value||0),0)>=t},K:function(e,n){const a=R(n);if(!a)return!1;const i=a.suit,t=n.reduce(((e,n)=>e+=n.value),0);return e.map((e=>h(e))).filter((e=>e&&e.suit===i)).reduce(((e,n)=>e+=n?.value||0),0)>=t}},C=()=>{let e="";let n=!1,a=!1;return{tick:i=>{const t=b("e5");if(!c.includes(i)||!t.length){if(function(e){d[e].forEach((e=>{const n=b(e.royalPile),a=R(n);a&&S[a.initial](e.cardsToCheck,n)&&n.forEach((e=>e.facingDown=!0))}))}(i),n=c.every((e=>{const n=b(e);return n.length>0&&n.every((e=>e.facingDown))})),n){console.log("YOU WIN!");const e=document.getElementById("gameWonDialog");return e.showModal(),void e.querySelector("#gameWonCloseButton")?.addEventListener("click",(()=>{e.close()}))}if(a=function(){const n=h("e5");return n?0===T(n).length?(e="No valid place to play card.",!0):void 0:(e="No more cards in draw pile.",!0)}(),a){const n=document.getElementById("gameLostDialog"),a=n.querySelector("#gameLostReason");a&&(a.innerHTML=e),n.showModal(),n.querySelector("#gameLostCloseButton")?.addEventListener("click",(()=>{n.close()}))}}}}};let y,w;function P(){y=D(),w=C(),Object.entries(m).forEach((([e,{cards:n}])=>{if("e5"!==e){const e=n.splice(0);e.forEach((e=>e.facingDown=!0)),o.addToDrawPile(e)}})),o.shuffle(3),function(){let e=!1,n=[];const a=Array.from(u);for(;!e;){const i=o.drawFromDrawPile(1)[0];if(i.facingDown=!1,k(i))i.facingDown=!0,n.push(i);else{const e=a.shift();e&&"c3"!==e&&m[e].cards.push(i)}0===a.length&&(e=!0)}o.addToTopOfDrawPile(n),o.drawPile[0].facingDown=!1}(),v(),E()}function E(){Array.from(document.getElementsByClassName("pile--valid")).forEach((e=>e.classList.remove("pile--valid")));const e=h("e5");if(e){const n=T(e);n.length&&function(e){e.forEach((e=>{const n=document.getElementById(e);n?.classList.add("pile--valid")}))}(n)}}document.addEventListener("DOMContentLoaded",(function(){P();Array.from(document.getElementsByClassName("pile")).forEach((e=>{"e5"!==e.id&&e.addEventListener("click",(function(){const n=e.id;e.classList.contains("pile--valid")&&(y.doShift("e5",n),w.tick(n),v(),E())}))}))})),document.getElementById("newGameButton")?.addEventListener("click",(()=>P())),document.getElementById("undoButton")?.addEventListener("click",(()=>{y.undo(),E()})),document.getElementById("redoButton")?.addEventListener("click",(()=>{y.redo(),E()}))}();
